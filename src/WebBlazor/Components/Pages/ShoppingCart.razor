@page "/shopping-cart"
@using Application.DomainModels
@using Application.UnitOfWork
@using Application.Services
@using Application.Utilities
@using Web.Cookies
@inherits OwningComponentBase<IUnitOfWork>

<main class="layout layout__full">
    <h3 class="cart-title">Shopping Cart</h3>

    @if (CartItems.Any())
    {
        <div class="cart__item-display">
            @foreach (var item in CartItems)
            {
                <div class="cart-item">
                    <img src="@item.ProductPhotoUrl" alt="Product photo" class="cart-item__img">
                    <h5 class="cart-item__product-name">@item.ProductName</h5>
                    <p class="cart-item__product-price">@item.ProductPrice</p>
                    <p class="cart-item__product-quantity">@item.Quantity</p>
                </div>
            }
        </div>

        <div class="cart__summary">
            <h4 class="cart-summary__title">Cart Summary</h4>
            <p class="cart-summary__total">Subtotal: @CartSummary.Subtotal</p>
            <p class="cart-summary__saving">Savings: @CartSummary.Discount</p>
            <p class="cart-summary__tax">Tax: @CartSummary.Tax</p>
            <p class="cart-summary__grand-total">Total: @CartSummary.TotalPrice</p>
        </div>
        <a href="/checkout" class="btn btn--md btn--primary">Checkout</a>
    }
    else
    {
        <p class="cart-empty">Your cart is empty</p>
    }


</main>

@code {

    [CascadingParameter]
    private HttpContext? Context { get; set; }

    private IEnumerable<CartItemListModel> CartItems { get; set; } = new List<CartItemListModel>();

    private CartSummaryModel CartSummary { get; set; } = new CartSummaryModel();

    protected override async Task OnInitializedAsync()
    {
        var cartId = Context?.Request.Cookies.GetCartIdCookie();

        if (cartId is not null)
        {
            CartItems = await Service.CartRepository.GetCartItemsAsync(cartId.Value);
            CartSummary = CartItems.GetCartSummary();
        }
    }

}